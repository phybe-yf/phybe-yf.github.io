<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¿»ç¿»çœ‹PKå¯¹æˆ˜ - åŒçŸ©é˜µç‰ˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        
        .game-container {
            width: 100%;
            max-width: 1000px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 95vh;
        }
        
        /* å¯¹æˆ˜ä¿¡æ¯åŒº */
        .battle-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: #fff;
            border-bottom: 2px solid #eee;
            height: 15%;
        }
        
        .player-info {
            display: flex;
            align-items: center;
            width: 35%;
        }
        
        .player-info.opponent {
            flex-direction: row-reverse;
            text-align: right;
        }
        
        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #4a9cff;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 24px;
            border: 3px solid #4a9cff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .player-info.opponent .avatar {
            background-color: #ff6b4a;
            border-color: #ff6b4a;
        }
        
        .player-info.leading .avatar {
            border-color: #ff3333;
            box-shadow: 0 0 15px rgba(255, 51, 51, 0.7);
        }
        
        .player-details {
            margin: 0 15px;
        }
        
        .player-name {
            font-size: 16px;
            color: #666;
            font-weight: 600;
        }
        
        .player-score {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin: 5px 0;
        }
        
        .player-info.losing .player-score {
            color: #aaa;
        }
        
        .streak {
            font-size: 14px;
            color: #ff9900;
            margin-top: 2px;
            font-weight: 600;
        }
        
        .battle-status {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }
        
        .status-text {
            font-size: 18px;
            color: #4a9cff;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .timer {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            font-family: 'Courier New', monospace;
        }
        
        .timer.warning {
            color: #ff3333;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }
        
        /* æ ¸å¿ƒæ¸¸æˆåŒº */
        .game-area {
            padding: 20px;
            height: 65%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .player-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 48%;
            height: 100%;
        }
        
        .player-label {
            font-size: 20px;
            margin-bottom: 15px;
            color: #4a9cff;
            font-weight: bold;
            padding: 8px 20px;
            background-color: rgba(74, 156, 255, 0.1);
            border-radius: 50px;
        }
        
        .player-area.opponent .player-label {
            color: #ff6b4a;
            background-color: rgba(255, 107, 74, 0.1);
        }
        
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-gap: 10px;
            width: 100%;
            max-width: 350px;
            height: 100%;
        }
        
        .card {
            aspect-ratio: 1 / 1;
            background-color: #1a2a6c;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.4s, background-color 0.3s, box-shadow 0.3s;
            position: relative;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .card.flipped {
            transform: rotateY(180deg);
        }
        
        .card.matched {
            transform: scale(0);
            transition: transform 0.5s, visibility 0s 0.5s;
            visibility: hidden;
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .card-back {
            background: linear-gradient(135deg, #1a2a6c, #4a9cff);
            color: white;
        }
        
        .card-back::after {
            content: "?";
            font-size: 28px;
            font-weight: bold;
        }
        
        .player-area.opponent .card-back {
            background: linear-gradient(135deg, #b21f1f, #ff6b4a);
        }
        
        .card-front {
            background-color: white;
            transform: rotateY(180deg);
            font-size: 32px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        .card.correct {
            background-color: #4CAF50;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.7);
        }
        
        .combo-popup {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 36px;
            font-weight: bold;
            color: gold;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            animation: comboFloat 1.5s ease-out forwards;
            z-index: 100;
            display: none;
        }
        
        @keyframes comboFloat {
            0% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateX(-50%) translateY(-100px);
            }
        }
        
        /* åŠŸèƒ½æ“ä½œåŒº */
        .action-area {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            height: 20%;
            background-color: #fff;
            border-top: 2px solid #eee;
        }
        
        .action-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .action-btn:hover {
            background-color: #e0e0e0;
            transform: scale(1.1);
        }
        
        .vs-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            margin: 0 20px;
        }
        
        .vs-text {
            font-size: 28px;
            font-weight: bold;
            color: #ff6b4a;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .progress-container {
            width: 100%;
            max-width: 200px;
        }
        
        .progress-bar {
            height: 12px;
            background-color: #f0f0f0;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4a9cff, #ff6b4a);
            border-radius: 6px;
            width: 50%;
            transition: width 0.5s;
        }
        
        .progress-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 14px;
            color: #666;
            font-weight: 600;
        }
        
        /* å¼¹çª— */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 450px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: popIn 0.3s ease-out;
        }
        
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .modal-title {
            font-size: 28px;
            margin-bottom: 20px;
            color: #1a2a6c;
            font-weight: bold;
        }
        
        .theme-options {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        
        .theme-option {
            padding: 12px 18px;
            background-color: #f0f0f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }
        
        .theme-option.selected {
            background-color: #4a9cff;
            color: white;
            transform: scale(1.05);
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background-color: #4a9cff;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #3a8cef;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #e0e0e0;
            transform: translateY(-2px);
        }
        
        .result-details {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        
        .result-player {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .winner-badge {
            margin-top: 10px;
            padding: 8px 15px;
            background: linear-gradient(135deg, gold, #ffd700);
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            color: #333;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .record-badge {
            margin-top: 15px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #ff6b4a, #ff3333);
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .game-container {
                max-width: 100%;
                height: 95vh;
            }
            
            .player-info {
                width: 40%;
            }
            
            .avatar {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .player-score {
                font-size: 24px;
            }
            
            .cards-grid {
                grid-gap: 8px;
                max-width: 300px;
            }
            
            .card-front {
                font-size: 28px;
            }
            
            .vs-container {
                margin: 0 10px;
            }
            
            .vs-text {
                font-size: 22px;
            }
        }
        
        @media (max-width: 480px) {
            .game-area {
                flex-direction: column;
                padding: 10px;
            }
            
            .player-area {
                width: 100%;
                margin-bottom: 15px;
            }
            
            .player-area.opponent {
                margin-bottom: 0;
            }
            
            .cards-grid {
                max-width: 320px;
            }
            
            .vs-container {
                flex-direction: row;
                width: 100%;
                margin: 10px 0;
            }
            
            .vs-text {
                margin: 0 10px;
            }
            
            .progress-container {
                max-width: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- å¯¹æˆ˜ä¿¡æ¯åŒº -->
        <div class="battle-info">
            <div class="player-info">
                <div class="avatar"><i class="fas fa-user"></i></div>
                <div class="player-details">
                    <div class="player-name">ç©å®¶A</div>
                    <div class="player-score">0</div>
                    <div class="streak">0è¿èƒœ</div>
                </div>
            </div>
            
            <div class="battle-status">
                <div class="status-text">å¯¹æˆ˜ä¸­</div>
                <div class="timer">00:00.0</div>
            </div>
            
            <div class="player-info opponent">
                <div class="avatar"><i class="fas fa-robot"></i></div>
                <div class="player-details">
                    <div class="player-name">ç©å®¶B</div>
                    <div class="player-score">0</div>
                    <div class="streak">0è¿èƒœ</div>
                </div>
            </div>
        </div>
        
        <!-- æ ¸å¿ƒæ¸¸æˆåŒº -->
        <div class="game-area">
            <div class="player-area">
                <div class="player-label">æˆ‘çš„åŒºåŸŸ</div>
                <div class="cards-grid" id="playerCardsGrid">
                    <!-- ç©å®¶å¡ç‰Œå°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <div class="vs-container">
                <div class="vs-text">VS</div>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-labels">
                        <span>ç©å®¶A</span>
                        <span>ç©å®¶B</span>
                    </div>
                </div>
            </div>
            
            <div class="player-area opponent">
                <div class="player-label">å¯¹æ‰‹åŒºåŸŸ</div>
                <div class="cards-grid" id="opponentCardsGrid">
                    <!-- å¯¹æ‰‹å¡ç‰Œå°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
        
        <!-- åŠŸèƒ½æ“ä½œåŒº -->
        <div class="action-area">
            <div class="action-btn" id="rulesBtn"><i class="fas fa-question"></i></div>
            
            <div class="action-btn" id="pauseBtn"><i class="fas fa-pause"></i></div>
        </div>
    </div>
    
    <!-- è¿å‡»æç¤º -->
    <div class="combo-popup" id="comboPopup">3è¿å‡»!</div>
    
    <!-- å¼€å±€å¼¹çª— -->
    <div class="modal" id="startModal">
        <div class="modal-content">
            <h2 class="modal-title">ç¿»ç¿»çœ‹PKå¯¹æˆ˜</h2>
            <p>åŒçŸ©é˜µå¯¹æˆ˜æ¨¡å¼ - æ¯”æ‹¼æ¶ˆé™¤é€Ÿåº¦</p>
            <p style="margin: 15px 0;">é€‰æ‹©å¡ç‰Œä¸»é¢˜ï¼š</p>
            <div class="theme-options">
                <div class="theme-option selected">åŠ¨ç‰©</div>
                <div class="theme-option">æ°´æœ</div>
                <div class="theme-option">æ•°å­—</div>
            </div>
            <button class="btn btn-primary" id="startGameBtn">å¼€å§‹å¯¹æˆ˜</button>
        </div>
    </div>
    
    <!-- è§„åˆ™å¼¹çª— -->
    <div class="modal" id="rulesModal" style="display: none;">
        <div class="modal-content">
            <h2 class="modal-title">æ¸¸æˆè§„åˆ™</h2>
            <p style="text-align: left; margin-bottom: 15px;">
                â€¢ åŒçŸ©é˜µå¯¹æˆ˜ï¼šåŒæ–¹å„è‡ªæ‹¥æœ‰ç‹¬ç«‹çš„4Ã—4ç¿»ç‰ŒçŸ©é˜µ<br>
                â€¢ åŒæ—¶æ“ä½œï¼šåŒæ–¹å¯ä»¥åŒæ—¶ç¿»ç‰Œï¼Œæ¯”æ‹¼æ¶ˆé™¤é€Ÿåº¦<br>
                â€¢ ç¿»åˆ°2å¼ ç›¸åŒå¡ç‰Œåˆ™æ¶ˆé™¤å¹¶è®¡åˆ†<br>
                â€¢ é”™è¯¯ç¿»ç‰Œæ— æ‰£åˆ†ä½†éœ€ç¿»é¢è¿˜åŸ<br>
                â€¢ å…ˆæ¶ˆé™¤æ‰€æœ‰å¡ç‰Œè€…èƒœ
            </p>
            <button class="btn btn-primary" id="closeRulesBtn">çŸ¥é“äº†</button>
        </div>
    </div>
    
    <!-- æš‚åœå¼¹çª— -->
    <div class="modal" id="pauseModal" style="display: none;">
        <div class="modal-content">
            <h2 class="modal-title">æ¸¸æˆæš‚åœ</h2>
            <button class="btn btn-primary" id="resumeBtn">ç»§ç»­æ¸¸æˆ</button>
            <button class="btn btn-secondary" id="surrenderBtn">æŠ•é™é€€å‡º</button>
        </div>
    </div>
    
    <!-- ç»“æŸå¼¹çª— -->
    <div class="modal" id="endModal" style="display: none;">
        <div class="modal-content">
            <h2 class="modal-title">æ¸¸æˆç»“æŸ</h2>
            <div class="result-details">
                <div class="result-player">
                    <div class="player-name">ç©å®¶A</div>
                    <div class="player-score" id="playerFinalScore">0åˆ†</div>
                    <div class="winner-badge" id="playerWinnerBadge" style="display: none;">èƒœåˆ©!</div>
                </div>
                <div class="result-player">
                    <div class="player-name">ç©å®¶B</div>
                    <div class="player-score" id="opponentFinalScore">0åˆ†</div>
                    <div class="winner-badge" id="opponentWinnerBadge" style="display: none;">èƒœåˆ©!</div>
                </div>
            </div>
            <div class="timer" id="finalTime" style="margin: 15px 0; font-size: 24px;">ç”¨æ—¶: 00:00.0</div>
            <div class="record-badge" id="recordBadge" style="display: none;">æ–°çºªå½•!</div>
            <button class="btn btn-primary" id="playAgainBtn">å†æ¥ä¸€å±€</button>
            <button class="btn btn-secondary" id="backToLobbyBtn">è¿”å›å¤§å…</button>
        </div>
    </div>

    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="correctSound" src="https://assets.mixkit.co/active_storage/sfx/257/257-preview.mp3" preload="auto"></audio>
    <audio id="winSound" src="https://assets.mixkit.co/active_storage/sfx/258/258-preview.mp3" preload="auto"></audio>

    <script>
        // æ¸¸æˆçŠ¶æ€å˜é‡
        let gameStarted = false;
        let gameFinished = false;
        let playerScore = 0;
        let opponentScore = 0;
        let startTime = 0;
        let timerInterval;
        let playerCombo = 0;
        let opponentCombo = 0;
        let playerFlippedCards = [];
        let opponentFlippedCards = [];
        let playerCanFlip = true;
        let opponentCanFlip = true;
        let bestTime = localStorage.getItem('bestTime') || Infinity;
        
        // å¡ç‰Œæ•°æ®
        const cardThemes = {
            animal: ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼'],
            fruit: ['ğŸ', 'ğŸŒ', 'ğŸ‡', 'ğŸ“', 'ğŸ‰', 'ğŸ‘', 'ğŸ’', 'ğŸ¥­'],
            number: ['1', '2', '3', '4', '5', '6', '7', '8']
        };
        
        // åˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', function() {
            // æ˜¾ç¤ºå¼€å§‹å¼¹çª—
            document.getElementById('startModal').style.display = 'flex';
            
            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            document.getElementById('startGameBtn').addEventListener('click', startGame);
            document.getElementById('rulesBtn').addEventListener('click', showRules);
            document.getElementById('closeRulesBtn').addEventListener('click', closeRules);
            document.getElementById('pauseBtn').addEventListener('click', showPauseMenu);
            document.getElementById('resumeBtn').addEventListener('click', resumeGame);
            document.getElementById('surrenderBtn').addEventListener('click', surrender);
            document.getElementById('playAgainBtn').addEventListener('click', playAgain);
            document.getElementById('backToLobbyBtn').addEventListener('click', backToLobby);
            
            // ä¸»é¢˜é€‰æ‹©
            const themeOptions = document.querySelectorAll('.theme-option');
            themeOptions.forEach(option => {
                option.addEventListener('click', function() {
                    themeOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
            
            // åˆå§‹åŒ–è¿›åº¦æ¡
            updateProgressBar();
        });
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            document.getElementById('startModal').style.display = 'none';
            gameStarted = true;
            gameFinished = false;
            playerScore = 0;
            opponentScore = 0;
            startTime = Date.now();
            
            // åˆå§‹åŒ–å¡ç‰Œ
            initializeCards();
            
            // å¼€å§‹è®¡æ—¶å™¨
            startTimer();
            
            // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
            updateScores();
        }
        
        // åˆå§‹åŒ–å¡ç‰Œ
        function initializeCards() {
            const playerCardsGrid = document.getElementById('playerCardsGrid');
            const opponentCardsGrid = document.getElementById('opponentCardsGrid');
            playerCardsGrid.innerHTML = '';
            opponentCardsGrid.innerHTML = '';
            
            // è·å–é€‰ä¸­çš„ä¸»é¢˜
            const selectedTheme = document.querySelector('.theme-option.selected').textContent;
            const themeKey = selectedTheme === 'åŠ¨ç‰©' ? 'animal' : 
                            selectedTheme === 'æ°´æœ' ? 'fruit' : 'number';
            
            // ä¸ºåŒæ–¹ç”Ÿæˆå¡ç‰Œ
            createCardGrid(playerCardsGrid, themeKey, 'player');
            createCardGrid(opponentCardsGrid, themeKey, 'opponent');
        }
        
        // åˆ›å»ºå¡ç‰Œç½‘æ ¼
        function createCardGrid(container, themeKey, playerType) {
            const symbols = [...cardThemes[themeKey], ...cardThemes[themeKey]];
            
            // æ´—ç‰Œç®—æ³•
            for (let i = symbols.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [symbols[i], symbols[j]] = [symbols[j], symbols[i]];
            }
            
            // åˆ›å»ºå¡ç‰Œ
            for (let i = 0; i < 16; i++) {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.symbol = symbols[i];
                card.dataset.index = i;
                
                const cardBack = document.createElement('div');
                cardBack.className = 'card-back';
                
                const cardFront = document.createElement('div');
                cardFront.className = 'card-front';
                cardFront.textContent = symbols[i];
                
                card.appendChild(cardBack);
                card.appendChild(cardFront);
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                card.addEventListener('click', function() {
                    if (gameStarted && !gameFinished && 
                        !card.classList.contains('flipped') && 
                        !card.classList.contains('matched')) {
                        
                        if (playerType === 'player' && playerCanFlip) {
                            flipCard(this, 'player');
                        } else if (playerType === 'opponent' && opponentCanFlip) {
                            flipCard(this, 'opponent');
                        }
                    }
                });
                
                container.appendChild(card);
            }
        }
        
        // ç¿»ç‰Œ
        function flipCard(card, playerType) {
            card.classList.add('flipped');
            
            if (playerType === 'player') {
                playerFlippedCards.push(card);
                
                if (playerFlippedCards.length === 2) {
                    playerCanFlip = false;
                    checkMatch(playerFlippedCards, 'player');
                }
            } else {
                opponentFlippedCards.push(card);
                
                if (opponentFlippedCards.length === 2) {
                    opponentCanFlip = false;
                    checkMatch(opponentFlippedCards, 'opponent');
                }
            }
        }
        
        // æ£€æŸ¥åŒ¹é…
        function checkMatch(cards, playerType) {
            const card1 = cards[0];
            const card2 = cards[1];
            
            if (card1.dataset.symbol === card2.dataset.symbol) {
                // åŒ¹é…æˆåŠŸ
                setTimeout(() => {
                    card1.classList.add('correct');
                    card2.classList.add('correct');
                    
                    // æ’­æ”¾æ­£ç¡®åŒ¹é…éŸ³æ•ˆ
                    document.getElementById('correctSound').play();
                    
                    setTimeout(() => {
                        card1.classList.add('matched');
                        card2.classList.add('matched');
                        
                        // æ›´æ–°åˆ†æ•°
                        if (playerType === 'player') {
                            playerScore++;
                            playerCombo++;
                            
                            // æ˜¾ç¤ºè¿å‡»æ•ˆæœ
                            if (playerCombo >= 2) {
                                showCombo(playerCombo, 'player');
                            }
                        } else {
                            opponentScore++;
                            opponentCombo++;
                            
                            // æ˜¾ç¤ºè¿å‡»æ•ˆæœ
                            if (opponentCombo >= 2) {
                                showCombo(opponentCombo, 'opponent');
                            }
                        }
                        
                        updateScores();
                        
                        // é‡ç½®ç¿»ç‰ŒçŠ¶æ€
                        if (playerType === 'player') {
                            playerFlippedCards = [];
                            playerCanFlip = true;
                        } else {
                            opponentFlippedCards = [];
                            opponentCanFlip = true;
                        }
                        
                        // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
                        checkGameEnd();
                    }, 500);
                }, 300);
            } else {
                // åŒ¹é…å¤±è´¥
                setTimeout(() => {
                    card1.classList.remove('flipped');
                    card2.classList.remove('flipped');
                    
                    // é‡ç½®è¿å‡»
                    if (playerType === 'player') {
                        playerCombo = 0;
                        playerFlippedCards = [];
                        playerCanFlip = true;
                    } else {
                        opponentCombo = 0;
                        opponentFlippedCards = [];
                        opponentCanFlip = true;
                    }
                }, 1000);
            }
        }
        
        // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
        function checkGameEnd() {
            const playerCards = document.querySelectorAll('#playerCardsGrid .card:not(.matched)');
            const opponentCards = document.querySelectorAll('#opponentCardsGrid .card:not(.matched)');
            
            if (playerCards.length === 0 || opponentCards.length === 0) {
                gameFinished = true;
                clearInterval(timerInterval);
                
                // æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ
                document.getElementById('winSound').play();
                
                // æ˜¾ç¤ºç»“æŸå¼¹çª—
                setTimeout(() => {
                    endGame();
                }, 1000);
            }
        }
        
        // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
        function updateScores() {
            document.querySelector('.player-info .player-score').textContent = playerScore;
            document.querySelector('.player-info.opponent .player-score').textContent = opponentScore;
            
            // æ›´æ–°é¢†å…ˆ/è½åçŠ¶æ€
            const playerInfo = document.querySelector('.player-info');
            const opponentInfo = document.querySelector('.player-info.opponent');
            
            if (playerScore > opponentScore) {
                playerInfo.classList.add('leading');
                playerInfo.classList.remove('losing');
                opponentInfo.classList.add('losing');
                opponentInfo.classList.remove('leading');
            } else if (playerScore < opponentScore) {
                playerInfo.classList.add('losing');
                playerInfo.classList.remove('leading');
                opponentInfo.classList.add('leading');
                opponentInfo.classList.remove('losing');
            } else {
                playerInfo.classList.remove('leading', 'losing');
                opponentInfo.classList.remove('leading', 'losing');
            }
            
            // æ›´æ–°è¿›åº¦æ¡
            updateProgressBar();
        }
        
        // æ›´æ–°è¿›åº¦æ¡
        function updateProgressBar() {
            const total = playerScore + opponentScore;
            const playerPercentage = total > 0 ? (playerScore / total) * 100 : 50;
            document.getElementById('progressFill').style.width = `${playerPercentage}%`;
        }
        
        // æ˜¾ç¤ºè¿å‡»æ•ˆæœ
        function showCombo(count, playerType) {
            const comboPopup = document.getElementById('comboPopup');
            comboPopup.textContent = `${count}è¿å‡»!`;
            comboPopup.style.display = 'block';
            
            // æ ¹æ®ç©å®¶ç±»å‹è°ƒæ•´ä½ç½®
            if (playerType === 'player') {
                comboPopup.style.left = '25%';
            } else {
                comboPopup.style.left = '75%';
            }
            
            setTimeout(() => {
                comboPopup.style.display = 'none';
            }, 1500);
        }
        
        // å¼€å§‹è®¡æ—¶å™¨
        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsedTime = Date.now() - startTime;
                const seconds = Math.floor(elapsedTime / 1000);
                const milliseconds = Math.floor((elapsedTime % 1000) / 100);
                
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                
                document.querySelector('.timer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}.${milliseconds}`;
            }, 100);
        }
        
        // æ˜¾ç¤ºè§„åˆ™
        function showRules() {
            document.getElementById('rulesModal').style.display = 'flex';
        }
        
        // å…³é—­è§„åˆ™
        function closeRules() {
            document.getElementById('rulesModal').style.display = 'none';
        }
        
        // æ˜¾ç¤ºæš‚åœèœå•
        function showPauseMenu() {
            if (gameStarted && !gameFinished) {
                document.getElementById('pauseModal').style.display = 'flex';
                clearInterval(timerInterval);
            }
        }
        
        // ç»§ç»­æ¸¸æˆ
        function resumeGame() {
            document.getElementById('pauseModal').style.display = 'none';
            startTimer();
        }
        
        // æŠ•é™
        function surrender() {
            document.getElementById('pauseModal').style.display = 'none';
            gameFinished = true;
            clearInterval(timerInterval);
            endGame();
        }
        
        // ç»“æŸæ¸¸æˆ
        function endGame() {
            const elapsedTime = Date.now() - startTime;
            const seconds = Math.floor(elapsedTime / 1000);
            const milliseconds = Math.floor((elapsedTime % 1000) / 100);
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            const finalTime = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}.${milliseconds}`;
            
            // ç¡®å®šèƒœè€…
            const playerWon = playerScore >= opponentScore;
            
            // æ›´æ–°ç»“æŸå¼¹çª—
            document.getElementById('playerFinalScore').textContent = `${playerScore}åˆ†`;
            document.getElementById('opponentFinalScore').textContent = `${opponentScore}åˆ†`;
            document.getElementById('finalTime').textContent = `ç”¨æ—¶: ${finalTime}`;
            
            if (playerWon) {
                document.getElementById('playerWinnerBadge').style.display = 'block';
                document.getElementById('opponentWinnerBadge').style.display = 'none';
            } else {
                document.getElementById('playerWinnerBadge').style.display = 'none';
                document.getElementById('opponentWinnerBadge').style.display = 'block';
            }
            
            // æ£€æŸ¥æ˜¯å¦ç ´çºªå½•
            if (elapsedTime < bestTime) {
                bestTime = elapsedTime;
                localStorage.setItem('bestTime', bestTime);
                document.getElementById('recordBadge').style.display = 'block';
            } else {
                document.getElementById('recordBadge').style.display = 'none';
            }
            
            document.getElementById('endModal').style.display = 'flex';
        }
        
        // å†æ¥ä¸€å±€
        function playAgain() {
            document.getElementById('endModal').style.display = 'none';
            startGame();
        }
        
        // è¿”å›å¤§å…
        function backToLobby() {
            document.getElementById('endModal').style.display = 'none';
            document.getElementById('startModal').style.display = 'flex';
        }
    </script>
</body>
</html>